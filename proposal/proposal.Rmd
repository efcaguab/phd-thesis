---
title: "The evolution of ecological networks"
author: "Fernando Cagua"
date: "`r format(Sys.Date(), '%B %Y')`"
output: 
  pdf_document:
    includes:
      in_header: header.tex
    toc: yes
    number_sections: no
bibliography: ../references.bib
biblatex: yes
documentclass: book
---
---
geometry: a4paper
geometry: showframe
geometry: margin=1in
geometry: bindingoffset=0in
geometry: twoside=FALSE
---

```{r libraries, echo = FALSE, message = FALSE}
library(ggdendro)
library(ape)
library(magrittr)
library(dplyr)
library(ggplot2)
library(reshape2)
library(grid)
source("./code/multiplot.R")
```


\newgeometry{right=3in, twoside=FALSE}

\chapter{Introduction}

Interaction strengths are defined There is a lack of evolution in multidimensional trait space

\chapter{Evolution and network structure?}

It has been previously shown that network structure has direct consequences on comunity persistance and stability and might also play an 

Network structure heavily affects community stability. Here we aim how network structure can arise from evolutionary dynamics.

Do modular communities evolve towards nested by minimising niche overlap. Do nested communities evolve towards modular patterns in the absence of disturbances?

There is evidence that shows 

How is nestedness reconciliated with coe

```{r, echo = FALSE, message = FALSE, fig.cap = "Interaction strength is related to the coevolutioary signal of an interaction.", fig.height = 3}

data.frame(x = c(0,1,1), 
           xend = c(1,2,2), 
           y = c(1,1,1),
           yend = c(1,2,1.5),
           type = c("generalists", "specialists", "generalists")) %>%
  ggplot() +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend, linetype = type)) +
  theme_classic() +
  ylim(0.7,2) +
  xlab("Interaction's contribution to coevolution") +
  ylab("Interaction strenght") +
  theme(text =  element_text(family = "Times"), 
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks = element_blank())+
  scale_linetype_discrete("")
```
```{r, echo = FALSE, message = FALSE, fig.cap = "In a bipartite network, interactions that support the congruence of the phylogenies -- solid lines -- are high contributors to coevolution. Opposite, the interactions that contribute little to coevolution -- dashed lines -- are those that 'distort' the congruence between phylogenies.", fig.height = 3}

s <- "owls(((A:4,B:4):3,C:7):6,D:13);"
cat(s, file = "./figures/ex.tre", sep = "\n")
tree.owls <- read.tree("./figures/ex.tre")

phylo <- tree.owls %>% 
  as.hclust() %>%
  dendro_data()

int <- diag(nrow(phylo$labels)) %>%
  `[<-`(4, 2, 1) %>%
  `[<-`(1, 4, 1) %>%
  `[<-`(4, 4, 0) %>%
  `row.names<-`(phylo$labels$label) %>%
  `colnames<-`(phylo$labels$label) %>%
  melt() %>%
  filter(value == 1) %>%
  mutate(coev = !(as.character(Var1) == as.character(Var2)),
         y = as.numeric(Var1),
         yend = as.numeric(Var2),
         x = 0,
         xend = 1)

my_theme <- theme(legend.position = "none", 
               plot.margin = unit (c (0,0,0,0), "pt"),
               text =  element_text(family = "Times")) +
  theme_dendro()
p1 <- ggplot(data = phylo$segments) +
  geom_segment(aes(x = x, y = y, yend = yend, xend = xend), 
               size = 1, colour = "grey30") +
  coord_flip() + ggtitle("Pollinators / Parasites") + my_theme 
p2 <- p1 + scale_y_reverse(expand = c(0.2, 0)) + ggtitle("Plants / Hosts") + 
    geom_text(data = phylo$labels, aes (x = x, y = y - 1.2, label = paste(label, "'", sep = ""))) +
    my_theme
p1 <- p1 + geom_text(data = phylo$labels, aes (x = x, y = y - 0.8, label = label))

i <- int %>%
  ggplot() +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend, linetype = coev),
               size = 1) +
  geom_point(aes(x = x, y = y)) +
  geom_point(aes(x = xend, y = yend)) + 
  my_theme + ggtitle("Interactions")
  
multiplot(p2, i, p1, layout =  matrix(c(1,1,1,2,2,3,3,3), nrow = 1, byrow = T))

```
# The contribution of evolution and spatiotemporal patterns to network structure

Hypothesis modularity comes from phylogenetic hystory and ecological traits. Nestedness come from spatiotemporal patterns (recent immigration, spatial and temporal overlap). Though nestedness can also arrise from weak coevolution and phenotype differences (which they argue is the one acting on species rich comunities)

## Phylogenetic history of modularity

Modules should show higher agreement to phylogenies than random modules

Dataset: all kind of networks we can get hands on

## Nestedness 

Specialists are more likely to be recent immigrants

Dataset: Wasps for spatial/ecological patterns
Dataset: Temporal pollina

Some evidence shows that most specialist species can be actually rencet imigrants and havent had the time adapt and either evolve large impacts on hosts or to become generalists [@Nuismer2003]. 

If that is true, then one should be able a) to see that the patterns of generalism/specialism for a species speciest changes in spatial scales; b) to see that individuals behaving as generalists in their communities should have greater performance (fitness, impact?) than the individuals from the same species behaving as generalists in their comunities. And that c) species should show be more specialists towards the fringes of their spatial distribution. Can we test that with the wasp-parasite UWA dataset?

Also in therms of phase shifts, if there is a sudden change in abiotic-conditions/community structure, then specialists would have a harder time adapting than generalists. Right? Is change in niche overlap what creates alternate stable states? Or if a specialist is still there will their perfornance decreasse after/along with the shif?

# Coevolution in multidimensional trait space 

Dataset: analytical and indvidual based models

Coevolution has been shown to generate anti-nested patterns. But all those models have used one mechanism for generating and only one trait at a time. Since interaction probabilities can affect a lot the nerwork structure we expect it to change when using multiple traits. 

\chapter{How community structure affects stability}

# Functional redundancy and stability

Species that share similar interactions in a ecological network can be grouped in modules. In food webs for example, modules can successfully encapsulate trophic groups that resemble energetic pathways [@Gauzens2014]. In host/parasite networks, a parasite is more likely to share hosts with other parasites within than outside it's module [@Weitz2013]. Similarly in mutualistic networks, pollinators within a module function as a group with preferences for some particular plants. 

Because the species's functional role in the community is, at least to a great extent, defined by its interactions [@Dehling2014], modules should implicitly group species with similar functional roles [@Dupont2009].

Functional redundancy has been proposed as an important factor in determining the ecosystem's response to disturbaces [@Brandl2014a]. Particularly when the 


In pollination networks   can be th  similarity of In ecological networks, 

Functional redundancParadojically high functional redundancy represents

Hypothesis: Functional redundant systems are more stable and resilient

Hypothesis: Systems with loss of functional groups are more vulnerable

# Dead ends in fitness landscapes

Hypothesis: very efficient performers in a fitness landscape are more vulnerable because the loss capacity of adaptation


# What is stability

# Coexistence and stability

Niche changes over time. Throphic plasticity Consequences for stability

## Niche overlap



\chapter{Temporal dynamics in ecological networks}

# Reconstructing historical networks

Measuring network fitness

Meassuring impact of hosts/infectivity

How is related to niche overlap and coexistence theory - Niche change over time

# Perturbing networks



\chapter{Ecosystem feedbacks are indirect interactions}

\newgeometry{margin=1in, twoside=FALSE}
\chapter*{References}








